# Резюме анализа ТЗ и архитектуры

## Анализ технического задания

### Основные компоненты системы:

1. **Frontend (Angular SPA)**
   - Одностраничное веб-приложение
   - Криптография на клиенте (Web Crypto API)
   - Управление токенами и сессиями
   - UI для работы с хранилищем паролей

2. **Backend (Node.js/Express)**
   - RESTful API
   - Аутентификация (JWT)
   - Работа с MongoDB
   - Middleware для безопасности
   - Аудит логирование

3. **Browser Extension**
   - Автозаполнение форм
   - Интеграция с основным API
   - Определение форм на страницах

4. **Database (MongoDB)**
   - Хранение пользователей
   - Зашифрованные записи хранилища
   - Сессии и устройства
   - Аудит логи

### Ключевые особенности безопасности:

- **Сквозное шифрование (E2EE)**: Все данные шифруются на клиенте
- **KDF (Argon2id)**: Современный алгоритм для выработки ключей
- **AES-256-GCM**: Аутентифицированное шифрование
- **2FA**: TOTP и WebAuthn поддержка
- **JWT**: Безопасная аутентификация с refresh токенами

## Созданная структура проекта

```
PasswordManager/
├── frontend/          # Angular приложение
├── backend/           # Express API
├── extension/         # Браузерное расширение
├── shared/            # Общие типы и константы
├── docs/              # Документация
├── README.md          # Основная документация
├── ARCHITECTURE.md    # Детальная архитектура
└── package.json       # Root конфигурация
```

## Основные моменты реализации

### 1. Криптография
- **KDF**: Argon2id с параметрами OWASP (19 МБ памяти, 2+ итерации)
- **Шифрование**: AES-256-GCM (256-битный ключ, 96-битный IV)
- **Генерация случайных**: `crypto.getRandomValues()` (клиент), `crypto.randomBytes()` (сервер)

### 2. Аутентификация
- Мастер-пароль **никогда** не отправляется на сервер
- Argon2id KDF выполняется **только на клиенте**
- На сервере хранится только `passwordVerifier` (результат KDF) для проверки
- Сервер **не выполняет** Argon2id для проверки пароля, только сравнивает verifier
- VaultKey (256-битный случайный ключ) хранится в БД в зашифрованном виде (`vaultKeyEnc`)
- VaultKey расшифровывается на клиенте и хранится только в памяти
- JWT токены с коротким временем жизни (1 час) + refresh токены (7 дней)

**Детальная схема**: См. `docs/CRYPTO_SCHEME.md`

### 3. Хранилище
- Каждая запись шифруется отдельно на клиенте с использованием VaultKey
- Сервер хранит только зашифрованные данные и **никогда не расшифровывает** их
- Поиск по записям выполняется **только на клиенте** по расшифрованным данным
- Сервер не индексирует содержимое vault по соображениям приватности
- Поддержка версионирования записей (`version`, `lastModified`) для синхронизации между устройствами

### 4. API Endpoints

**Аутентификация:**
- `POST /auth/register` - Регистрация
- `POST /auth/login` - Вход
- `POST /auth/logout` - Выход
- `POST /auth/refresh` - Обновление токена
- `POST /auth/totp/enable` - Включение TOTP
- `POST /auth/webauthn/register` - Регистрация WebAuthn

**Хранилище:**
- `GET /vault/items` - Получить все записи
- `POST /vault/items` - Создать запись
- `PUT /vault/items/:id` - Обновить запись
- `DELETE /vault/items/:id` - Удалить запись
- `GET /vault/backup` - Экспорт
- `POST /vault/restore` - Импорт

**Сессии:**
- `GET /sessions` - Список активных сессий
- `DELETE /sessions/:id` - Завершить сессию

## Следующие шаги

1. **Инициализация проектов**
   - Создать Angular проект в `frontend/`
   - Создать Express проект в `backend/`
   - Настроить TypeScript для extension

2. **Базовая инфраструктура**
   - Настроить MongoDB подключение
   - Создать базовые модели
   - Настроить Express middleware

3. **Реализация аутентификации**
   - Регистрация и вход
   - Криптография на клиенте
   - JWT токены

4. **Хранилище паролей**
   - CRUD операции
   - Шифрование/расшифровка
   - UI компоненты

## Важные замечания

- Все криптографические операции с пользовательскими данными выполняются **только на клиенте**
- Сервер **никогда** не видит незашифрованные данные хранилища
- Сервер **не выполняет** Argon2id для проверки пароля - только сравнивает готовый verifier
- VaultKey хранится **только в памяти** клиента и очищается при логауте
- Мастер-пароль **никогда** не сохраняется и не отправляется на сервер
- Сервер использует криптографию только для внутренних задач (JWT, хеши токенов)
- Используются только криптографически стойкие алгоритмы и библиотеки

## Документация

- `README.md` - Общее описание проекта
- `ARCHITECTURE.md` - Детальная архитектура системы
- `docs/STRUCTURE.md` - Структура папок и файлов
- `docs/IMPLEMENTATION_PLAN.md` - План реализации по этапам
- `docs/CRYPTO_SCHEME.md` - Детальная схема криптографии и управления ключами
