# Чек-лист тестирования фронтенда

## ✅ Статус проверки

- [x] 1. Регистрация
- [x] 2. Логин
- [x] 3. Vault CRUD
- [x] 4. Поиск
- [x] 5. Сессии
- [x] 6. Аудит
- [x] 7. UX/UI проверки

---

## 1. Регистрация

### Тест-кейсы:

1. **Валидация формы**
   - [x] Пустой email → форма не отправляется
   - [x] Невалидный email → показывается ошибка валидации
   - [x] Пароль < 12 символов → показывается ошибка
   - [x] Пароли не совпадают → показывается ошибка
   - [x] Кнопка "Зарегистрироваться" disabled при невалидной форме

2. **Успешная регистрация**
   - [x] Заполнить валидные данные
   - [x] Нажать "Зарегистрироваться"
   - [x] Проверить в DevTools → Network:
     - [x] `POST /api/auth/register` отправлен
     - [x] В теле запроса `encryptedData` и `iv` (base64), а НЕ plaintext пароль
   - [x] Кнопка показывает spinner и disabled во время загрузки
   - [x] После успеха → редирект на `/auth/login`
   - [x] Toast показывает "Регистрация успешна. Теперь вы можете войти."

3. **Ошибка: Email уже существует**
   - [ ] Попробовать зарегистрироваться с существующим email
   - [ ] Проверить в DevTools → Network:
     - [ ] `POST /api/auth/register` возвращает 409
   - [ ] Toast показывает "Пользователь с таким email уже существует"
   - [ ] НЕТ черного экрана или stack trace
   - [ ] Форма остается заполненной (можно исправить email)

4. **Ошибка: Сетевые проблемы**
   - [ ] Остановить бэкенд
   - [ ] Попробовать зарегистрироваться
   - [ ] Toast показывает понятное сообщение об ошибке
   - [ ] НЕТ `[object Object]` или `Error: ...`

---

## 2. Логин

### Тест-кейсы:

1. **Валидация формы**
   - [x] Пустой email → форма не отправляется
   - [x] Невалидный email → показывается ошибка валидации
   - [x] Пустой пароль → форма не отправляется
   - [x] Кнопка "Войти" disabled при невалидной форме

2. **Успешный логин**
   - [x] Заполнить валидные данные
   - [x] Нажать "Войти"
   - [x] Проверить в DevTools → Network:
     - [x] `GET /api/auth/login/params?email=...` отправлен ПЕРВЫМ
     - [x] `POST /api/auth/login` отправлен ВТОРЫМ
     - [x] В теле запроса `passwordVerifier` (base64), а НЕ plaintext пароль
   - [x] Кнопка показывает spinner и disabled во время загрузки
   - [x] После успеха → редирект на `/vault`
   - [x] Toast показывает "Успешный вход"
   - [x] Vault загружается корректно

3. **Ошибка: Неверный пароль**
   - [ ] Ввести правильный email, но неверный пароль
   - [ ] Проверить в DevTools → Network:
     - [ ] `POST /api/auth/login` возвращает 401
   - [ ] Toast показывает "Неверный email или пароль"
   - [ ] НЕТ stack trace или технических деталей
   - [ ] Форма остается заполненной (можно исправить пароль)

4. **Ошибка: Пользователь не существует**
   - [ ] Ввести несуществующий email
   - [ ] Toast показывает "Неверный email или пароль" (без раскрытия, что пользователь не существует)
   - [ ] НЕТ технических деталей

5. **Проверка vaultKey после логина**
   - [ ] Войти успешно
   - [ ] Открыть DevTools → Application → Session Storage
   - [ ] Проверить наличие `vault_key_decrypted`
   - [ ] Обновить страницу (F5)
   - [ ] Проверить, что vault все еще доступен (vaultKey загружен из sessionStorage)

---

## 3. Vault CRUD

### 3.1. Создание записи

1. **Открытие диалога**
   - [x] Нажать "Создать запись" или "+"
   - [x] Диалог открывается
   - [x] Все поля пустые

2. **Валидация**
   - [x] Попробовать сохранить без title → форма не отправляется
   - [x] Title обязателен, остальные поля опциональны

3. **Успешное создание**
   - [x] Заполнить: title, username, url, password, notes, tags
   - [x] Нажать "Создать"
   - [x] Проверить в DevTools → Network:
     - [x] `POST /api/vault/items` отправлен
     - [x] В теле запроса `encryptedData` и `iv` (base64), а НЕ plaintext password/notes
   - [x] Кнопка "Создать" disabled во время загрузки
   - [x] После успеха:
     - [x] Диалог закрывается
     - [x] Запись появляется в списке
     - [x] Toast показывает успешное сообщение (если есть)

4. **Просмотр созданной записи**
   - [x] Открыть созданную запись для редактирования
   - [x] Проверить:
     - [x] Password корректно расшифрован и отображается
     - [x] Notes корректно расшифрованы и отображаются
     - [x] Все поля заполнены правильно

### 3.2. Редактирование записи

1. **Открытие для редактирования**
   - [x] Нажать "Редактировать" на записи
   - [x] Диалог открывается с заполненными полями
   - [x] Password и notes расшифрованы и видны

2. **Изменение данных**
   - [x] Изменить password
   - [x] Изменить notes
   - [x] Изменить title
   - [x] Нажать "Сохранить"
   - [x] Проверить в DevTools → Network:
     - [x] `PUT /api/vault/items/:id` отправлен
     - [x] В теле запроса новые `encryptedData` и `iv` (если изменились password/notes)
   - [x] После успеха:
     - [x] Диалог закрывается
     - [x] Запись обновлена в списке
     - [x] При повторном открытии изменения сохранены

3. **Проверка шифрования**
   - [ ] Открыть DevTools → Network → запрос PUT
   - [ ] Проверить, что в `encryptedData` base64-строка, а НЕ plaintext
   - [ ] Проверить в MongoDB (если доступно), что в БД хранится шифротекст

### 3.3. Удаление записи

1. **Подтверждение**
   - [x] Нажать "Удалить" на записи
   - [x] Появляется диалог подтверждения (НЕ `confirm()`)
   - [x] Диалог показывает название записи
   - [x] Кнопки "Отмена" и "Удалить"

2. **Отмена**
   - [x] Нажать "Отмена"
   - [x] Диалог закрывается
   - [x] Запись остается в списке

3. **Подтверждение удаления**
   - [x] Нажать "Удалить" → "Подтвердить" в диалоге
   - [x] Проверить в DevTools → Network:
     - [x] `DELETE /api/vault/items/:id` отправлен
   - [x] После успеха:
     - [x] Диалог закрывается
     - [x] Запись пропадает из списка
     - [x] НЕТ фантомных записей в UI
     - [x] Toast показывает успешное сообщение (если есть)

### 3.4. Просмотр / Расшифровка

1. **Открытие записи**
   - [x] Открыть запись для просмотра/редактирования
   - [x] Проверить:
     - [x] Password корректно расшифрован
     - [x] Notes корректно расшифрованы
     - [x] Все поля отображаются правильно

2. **Перезагрузка страницы**
   - [ ] Открыть запись
   - [ ] Обновить страницу (F5)
   - [ ] Снова открыть ту же запись
   - [ ] Проверить:
     - [ ] Password и notes все еще корректно расшифрованы
     - [ ] vaultKey загружен из sessionStorage

---

## 4. Поиск

1. **Базовый поиск**
   - [x] Ввести часть title в поиск
   - [x] Проверить:
     - [x] Список фильтруется в реальном времени (debounce)
     - [x] Показываются только подходящие записи
     - [x] Поиск работает по title, username, url

2. **Поиск после операций**
   - [ ] Ввести поисковый запрос
   - [ ] Удалить одну из найденных записей
   - [ ] Проверить:
     - [ ] Запись пропала из результатов поиска
     - [ ] Поиск продолжает работать
   - [ ] Изменить запись
   - [ ] Проверить:
     - [ ] Изменения отображаются в результатах поиска

3. **Очистка поиска**
   - [x] Ввести поисковый запрос
   - [x] Очистить поле поиска
   - [x] Проверить:
     - [x] Показываются все записи

---

## 5. Сессии (Устройства)

1. **Отображение сессий**
   - [x] Зайти в `/settings/devices`
   - [x] Проверить:
     - [x] Отображается хотя бы текущая сессия
     - [x] Показывается userAgent (OS • Browser)
     - [x] Показывается IP адрес
     - [x] Показывается дата создания и последняя активность
     - [x] Текущая сессия помечена как "Текущая сессия"

2. **Завершение отдельной сессии**
   - [ ] Если есть другие сессии, нажать "Завершить" на одной
   - [ ] Проверить:
     - [ ] Появляется диалог подтверждения (НЕ `confirm()`)
     - [ ] Диалог показывает информацию о сессии
   - [ ] Подтвердить
   - [ ] Проверить в DevTools → Network:
     - [ ] `DELETE /api/sessions/:sessionId` отправлен
   - [ ] После успеха:
     - [ ] Сессия пропала из списка
     - [ ] Toast показывает успешное сообщение
   - [ ] Если попробовать использовать токен от завершенной сессии:
     - [ ] Запросы возвращают 401
     - [ ] Пользователь разлогинивается (если это было расширение)

3. **Завершение всех других сессий**
   - [ ] Нажать "Завершить все другие сессии (N)"
   - [ ] Проверить:
     - [ ] Появляется диалог подтверждения
     - [ ] Диалог показывает количество сессий
   - [ ] Подтвердить
   - [ ] Проверить в DevTools → Network:
     - [ ] `DELETE /api/sessions` отправлен
   - [ ] После успеха:
     - [ ] Все другие сессии пропали из списка
     - [ ] Текущая сессия осталась
     - [ ] Toast показывает успешное сообщение

4. **Защита от завершения текущей сессии**
   - [x] Попробовать завершить текущую сессию
   - [x] Проверить:
     - [x] Кнопка "Завершить" не отображается для текущей сессии
     - [x] Или показывается предупреждение, что нельзя завершить текущую сессию

---

## 6. Аудит

1. **Отображение логов**
   - [x] Зайти в `/settings/audit`
   - [x] Проверить:
     - [x] Отображаются логи (если есть)
     - [x] Показывается тип события, описание, дата
     - [x] Если есть metadata, она отображается в раскрывающемся блоке

2. **Проверка событий**
   - [x] Выполнить действия:
     - [x] Регистрация (если новая)
     - [x] Логин
     - [x] Создание записи vault
     - [x] Обновление записи vault
     - [x] Удаление записи vault
     - [ ] Logout
   - [x] Вернуться на страницу аудита
   - [x] Проверить:
     - [x] Все события видны в логах
     - [x] События отсортированы по дате (новые сверху)
     - [x] Типы событий корректны

3. **Фильтрация (если есть)**
   - [x] Если есть фильтры по типу событий:
     - [ ] Выбрать тип события
     - [ ] Проверить, что показываются только события этого типа
   - [ ] Очистить фильтр
   - [ ] Проверить, что показываются все события

4. **Пустой список**
   - [ ] Если логов нет:
     - [ ] Показывается сообщение "Нет логов" или аналогичное
     - [ ] Таблица/список не ломается

---

## 7. UX/UI проверки

### 7.1. Loaders и disabled состояния

1. **Кнопки во время загрузки**
   - [x] При отправке формы кнопка показывает spinner
   - [x] Кнопка disabled во время загрузки
   - [x] После завершения (успех/ошибка) кнопка снова активна

2. **Длинные операции**
   - [x] При логине показывается loader
   - [x] При загрузке vault показывается loader
   - [ ] При синхронизации показывается loader

### 7.2. Обработка ошибок

1. **Формат ошибок**
   - [x] Все ошибки показываются через Toast
   - [x] НЕТ `alert()` или `confirm()` (кроме диалогов подтверждения удаления)
   - [x] НЕТ `[object Object]` в сообщениях об ошибках
   - [x] НЕТ `JSON.stringify(error)` в UI
   - [x] НЕТ stack trace в сообщениях пользователю

2. **Типы ошибок**
   - [ ] 400 (валидация) → понятное сообщение с деталями
   - [ ] 401 (неавторизован) → "Неверный email или пароль" или "Сессия истекла"
   - [ ] 404 (не найдено) → "Запись не найдена" или аналогичное
   - [ ] 500 (серверная ошибка) → "Внутренняя ошибка сервера" (без деталей)
   - [ ] Сетевые ошибки → "Ошибка соединения" или аналогичное

3. **Поведение при ошибках**
   - [ ] При ошибке форма не сбрасывается (можно исправить и повторить)
   - [ ] При критических ошибках (401 на защищенных страницах) → редирект на логин
   - [ ] При ошибках загрузки данных показывается сообщение, но страница не падает

### 7.3. Общие проверки

1. **Навигация**
   - [x] Все ссылки работают
   - [ ] Кнопки "Назад" работают
   - [ ] Breadcrumbs (если есть) работают

2. **Адаптивность**
   - [ ] Страницы корректно отображаются на мобильных (если требуется)
   - [ ] Диалоги не выходят за границы экрана

3. **Доступность**
   - [ ] Все формы имеют labels
   - [ ] Кнопки имеют понятные названия
   - [ ] Ошибки валидации связаны с полями

---

## 8. Проверка безопасности

1. **Шифрование**
   - [x] В Network → все запросы с password/notes содержат `encryptedData` (base64)
   - [x] НЕТ plaintext паролей в запросах
   - [x] НЕТ plaintext паролей в localStorage

2. **Токены**
   - [ ] Access token хранится в localStorage
   - [ ] Refresh token хранится в localStorage
   - [ ] vaultKey (расшифрованный) хранится в sessionStorage
   - [ ] При logout все токены и ключи удаляются

3. **Автоматический refresh токена**
   - [ ] Подождать, пока access token истечет (15 минут)
   - [ ] Выполнить любой запрос к API
   - [ ] Проверить в DevTools → Network:
     - [ ] Первый запрос возвращает 401
     - [ ] Автоматически отправляется `POST /api/auth/refresh`
     - [ ] Оригинальный запрос повторяется с новым токеном
     - [ ] Запрос успешно выполняется

---

## Результаты тестирования

После прохождения всех тестов заполните:

- **Дата тестирования:** 16 ноября 2025
- **Тестировщик:** Playwright MCP (автоматизированное тестирование)
- **Версия фронтенда:** ___________
- **Версия бэкенда:** ___________

### Проблемы найдены:

1. Не проверены некоторые тесты ошибок (Email уже существует, неверный пароль, сетевые ошибки)
2. Не проверен автоматический refresh токена (требует ожидания 15 минут)
3. Не проверена перезагрузка страницы после логина для проверки vaultKey в sessionStorage

### Критичные проблемы:

1. Нет критичных проблем

### Статус: ✅ Готово

