<div class="container mx-auto p-6 max-w-7xl">
  <div class="mb-6 flex items-center justify-between">
    <div>
      <h1 class="text-3xl font-bold tracking-tight">Хранилище паролей</h1>
      <p class="text-sm text-muted-foreground mt-1">Управляйте своими паролями безопасно</p>
    </div>
    <ui-button (click)="onAddClick()" size="lg">
      <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg>
      Добавить запись
    </ui-button>
  </div>

  <div class="mb-6">
    <ui-input
      id="vault-search-input"
      [(ngModel)]="searchQuery"
      (ngModelChange)="onSearchChange($event)"
      placeholder="Поиск по записям..."
      class="max-w-md"
    />
  </div>

  @if (isLoading) {
    <div class="flex items-center justify-center py-12">
      <div class="text-muted-foreground">Загрузка...</div>
    </div>
  } @else if (filteredItems.length === 0) {
    <ui-card>
      <div class="p-12 text-center">
        <p class="text-muted-foreground">
          {{ searchQuery ? 'Ничего не найдено' : 'Нет записей. Создайте первую запись!' }}
        </p>
      </div>
    </ui-card>
  } @else {
    <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
      @for (item of filteredItems; track item.id) {
        <ui-card class="hover:shadow-md transition-shadow duration-200 cursor-pointer border-2 hover:border-primary/20">
          <div class="p-5">
            <div class="mb-4 flex items-start justify-between">
              <div class="flex-1 min-w-0">
                <h3 class="text-lg font-semibold mb-1 truncate">{{ item.title }}</h3>
                @if (item.url) {
                  <a
                    [href]="item.url"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="text-sm text-primary hover:underline truncate block"
                  >
                    {{ item.url }}
                  </a>
                }
              </div>
              <div class="flex gap-1 ml-2 flex-shrink-0">
                <button
                  type="button"
                  class="rounded-md p-1.5 text-muted-foreground hover:text-foreground hover:bg-accent transition-colors"
                  (click)="onEditClick(item); $event.stopPropagation()"
                  title="Редактировать"
                >
                  <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                  </svg>
                </button>
                <button
                  type="button"
                  class="rounded-md p-1.5 text-muted-foreground hover:text-destructive hover:bg-destructive/10 transition-colors"
                  (click)="onDeleteClick(item); $event.stopPropagation()"
                  title="Удалить"
                >
                  <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                  </svg>
                </button>
              </div>
            </div>

            <div class="space-y-2">
              @if (item.username) {
                <div class="flex items-center gap-2 p-2 rounded-md bg-muted/50 hover:bg-muted transition-colors">
                  <span class="text-xs text-muted-foreground font-medium min-w-[60px]">Логин:</span>
                  <span class="flex-1 text-sm font-mono truncate">{{ item.username }}</span>
                  <button
                    type="button"
                    class="text-xs text-primary hover:text-primary/80 hover:underline flex-shrink-0 px-2 py-1 rounded hover:bg-primary/10 transition-colors"
                    (click)="copyToClipboard(item.username, 'Логин'); $event.stopPropagation()"
                  >
                    Копировать
                  </button>
                </div>
              }

              @if (item.password) {
                <div class="flex items-center gap-2 p-2 rounded-md bg-muted/50 hover:bg-muted transition-colors">
                  <span class="text-xs text-muted-foreground font-medium min-w-[60px]">Пароль:</span>
                  <span class="flex-1 text-sm font-mono">••••••••</span>
                  <button
                    type="button"
                    class="text-xs text-primary hover:text-primary/80 hover:underline flex-shrink-0 px-2 py-1 rounded hover:bg-primary/10 transition-colors"
                    (click)="copyToClipboard(item.password, 'Пароль'); $event.stopPropagation()"
                  >
                    Копировать
                  </button>
                </div>
              }

              @if (item.notes) {
                <div class="text-sm text-muted-foreground">
                  <p class="line-clamp-2">{{ item.notes }}</p>
                </div>
              }

              @if (item.tags && item.tags.length > 0) {
                <div class="flex flex-wrap gap-1">
                  @for (tag of item.tags; track tag) {
                    <span class="rounded-full bg-accent px-2 py-0.5 text-xs text-accent-foreground">
                      {{ tag }}
                    </span>
                  }
                </div>
              }
            </div>
          </div>
        </ui-card>
      }
    </div>
  }

  <app-vault-item-dialog
    [show]="showDialog"
    [item]="editingItem"
    (close)="onDialogClose()"
    (save)="onDialogSave($event)"
  />

  <!-- Диалог подтверждения удаления -->
  <ui-dialog
    [show]="showDeleteDialog"
    title="Подтверждение удаления"
    width="sm"
    (close)="onCancelDelete()"
  >
    <div class="space-y-4">
      <p class="text-sm text-muted-foreground">
        Вы уверены, что хотите удалить запись <strong>"{{ itemToDelete?.title }}"</strong>?
        Это действие нельзя отменить.
      </p>
      <div class="flex justify-end gap-2">
        <ui-button variant="outline" (click)="onCancelDelete()">
          Отмена
        </ui-button>
        <ui-button variant="danger" (click)="onConfirmDelete()">
          Удалить
        </ui-button>
      </div>
    </div>
  </ui-dialog>
</div>

